<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Generalized Linear Models | Linear models in Agriculture and Natural Resources</title>
  <meta name="description" content="<p>This book contains code associated with ALS6502C.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Generalized Linear Models | Linear models in Agriculture and Natural Resources" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This book contains code associated with ALS6502C.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Generalized Linear Models | Linear models in Agriculture and Natural Resources" />
  
  <meta name="twitter:description" content="<p>This book contains code associated with ALS6502C.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Phil Hahn &amp; Leo Ohyama" />


<meta name="date" content="2025-01-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-management-and-exploration.html"/>
<link rel="next" href="mixed-effect-models.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Linear Models in Agriculture and Natural Resources</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#learning-outcomes"><i class="fa fa-check"></i><b>1.1</b> Learning outcomes:</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#overview-of-statistical-analysis-workflow"><i class="fa fa-check"></i><b>1.2</b> Overview of statistical analysis workflow</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#workflow-pre-analysis"><i class="fa fa-check"></i><b>1.2.1</b> Workflow pre-analysis</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#workflow-for-analysis"><i class="fa fa-check"></i><b>1.2.2</b> Workflow for analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html"><i class="fa fa-check"></i><b>2</b> Data vizualization and review of linear models</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#introduction-to-data-visualization"><i class="fa fa-check"></i><b>2.1</b> Introduction to Data Visualization</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#continuous-variables"><i class="fa fa-check"></i><b>2.1.1</b> Continuous Variables</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#fancy-scatter-plots"><i class="fa fa-check"></i><b>2.1.2</b> Fancy Scatter plots</a></li>
<li class="chapter" data-level="2.1.3" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#categorical-variables"><i class="fa fa-check"></i><b>2.1.3</b> Categorical Variables</a></li>
<li class="chapter" data-level="2.1.4" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#plots-for-categorical-data-with-ggplot2"><i class="fa fa-check"></i><b>2.1.4</b> Plots for categorical data with ggplot2</a></li>
<li class="chapter" data-level="2.1.5" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#breakout-group-challenge"><i class="fa fa-check"></i><b>2.1.5</b> Breakout group challenge</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#regression-as-a-linear-model"><i class="fa fa-check"></i><b>2.2</b> Regression as a linear model</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#an-example-of-linear-regression-in-r"><i class="fa fa-check"></i><b>2.2.1</b> An Example of Linear Regression in R</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#regression-challenge"><i class="fa fa-check"></i><b>2.2.2</b> Regression Challenge</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#anova-as-a-linear-model"><i class="fa fa-check"></i><b>2.3</b> ANOVA as a linear model</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#example-of-a-one-way-anova-in-r"><i class="fa fa-check"></i><b>2.3.1</b> Example of a one-way ANOVA in R</a></li>
<li class="chapter" data-level="2.3.2" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#anova-challenge"><i class="fa fa-check"></i><b>2.3.2</b> ANOVA Challenge</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#extra-data-visualization"><i class="fa fa-check"></i><b>2.4</b> Extra Data Visualization</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#adding-model-averages-to-plots"><i class="fa fa-check"></i><b>2.4.1</b> Adding Model Averages to Plots</a></li>
<li class="chapter" data-level="2.4.2" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#extra-r-challenge"><i class="fa fa-check"></i><b>2.4.2</b> Extra R Challenge</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="data-vizualization-and-review-of-linear-models.html"><a href="data-vizualization-and-review-of-linear-models.html#ggplot2-app-via-shiny"><i class="fa fa-check"></i><b>2.5</b> ggplot2 app via Shiny</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-management-and-exploration.html"><a href="data-management-and-exploration.html"><i class="fa fa-check"></i><b>3</b> Data Management and Exploration</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-management-and-exploration.html"><a href="data-management-and-exploration.html#data-management"><i class="fa fa-check"></i><b>3.1</b> Data Management</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="data-management-and-exploration.html"><a href="data-management-and-exploration.html#making-and-modifying-variables"><i class="fa fa-check"></i><b>3.1.1</b> Making and modifying variables</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-management-and-exploration.html"><a href="data-management-and-exploration.html#variables-with-the-tidyverse"><i class="fa fa-check"></i><b>3.1.2</b> Variables with the tidyverse</a></li>
<li class="chapter" data-level="3.1.3" data-path="data-management-and-exploration.html"><a href="data-management-and-exploration.html#reshape-data-for-better-usability"><i class="fa fa-check"></i><b>3.1.3</b> Reshape data for better usability</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-management-and-exploration.html"><a href="data-management-and-exploration.html#data-exploration"><i class="fa fa-check"></i><b>3.2</b> Data Exploration</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-management-and-exploration.html"><a href="data-management-and-exploration.html#distributions-summary-statistics"><i class="fa fa-check"></i><b>3.2.1</b> Distributions &amp; summary statistics</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-management-and-exploration.html"><a href="data-management-and-exploration.html#examining-for-outliers"><i class="fa fa-check"></i><b>3.2.2</b> Examining for outliers</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-management-and-exploration.html"><a href="data-management-and-exploration.html#exploring-relationships-in-data"><i class="fa fa-check"></i><b>3.2.3</b> Exploring relationships in data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-management-and-exploration.html"><a href="data-management-and-exploration.html#model-selection"><i class="fa fa-check"></i><b>3.3</b> Model Selection</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="data-management-and-exploration.html"><a href="data-management-and-exploration.html#quick-introduction"><i class="fa fa-check"></i><b>3.3.1</b> Quick introduction</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-management-and-exploration.html"><a href="data-management-and-exploration.html#basic-calculations"><i class="fa fa-check"></i><b>3.3.2</b> Basic calculations</a></li>
<li class="chapter" data-level="3.3.3" data-path="data-management-and-exploration.html"><a href="data-management-and-exploration.html#aicc"><i class="fa fa-check"></i><b>3.3.3</b> AICc</a></li>
<li class="chapter" data-level="3.3.4" data-path="data-management-and-exploration.html"><a href="data-management-and-exploration.html#case-study-with-aic"><i class="fa fa-check"></i><b>3.3.4</b> Case study with AIC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html"><i class="fa fa-check"></i><b>4</b> Generalized Linear Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#overview-of-generalized-linear-models"><i class="fa fa-check"></i><b>4.1</b> Overview of Generalized Linear Models</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#example-one-way-anova-with-non-normal-data"><i class="fa fa-check"></i><b>4.1.1</b> Example: One-way ANOVA with non-normal data</a></li>
<li class="chapter" data-level="4.1.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#log-linear-model"><i class="fa fa-check"></i><b>4.1.2</b> Log-linear model</a></li>
<li class="chapter" data-level="4.1.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#generalized-linear-models-glms"><i class="fa fa-check"></i><b>4.1.3</b> Generalized linear models (GLMs)</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#overdispersion"><i class="fa fa-check"></i><b>4.2</b> Overdispersion</a></li>
<li class="chapter" data-level="4.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#binomial-glm"><i class="fa fa-check"></i><b>4.3</b> Binomial GLM</a></li>
<li class="chapter" data-level="4.4" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#gamma-glm"><i class="fa fa-check"></i><b>4.4</b> Gamma GLM</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#example-1"><i class="fa fa-check"></i><b>4.4.1</b> Example 1</a></li>
<li class="chapter" data-level="4.4.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#example-2"><i class="fa fa-check"></i><b>4.4.2</b> Example 2</a></li>
<li class="chapter" data-level="4.4.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#example-3"><i class="fa fa-check"></i><b>4.4.3</b> Example 3</a></li>
<li class="chapter" data-level="4.4.4" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#example-4"><i class="fa fa-check"></i><b>4.4.4</b> Example 4</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#briefly-running-gamma-glms"><i class="fa fa-check"></i><b>4.5</b> Briefly running Gamma GLMs</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html"><i class="fa fa-check"></i><b>5</b> Mixed-effect models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#interactions-in-statistical-models"><i class="fa fa-check"></i><b>5.1</b> Interactions in statistical models</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#ancova-multiple-intercept-model"><i class="fa fa-check"></i><b>5.1.1</b> ANCOVA: multiple intercept model</a></li>
<li class="chapter" data-level="5.1.2" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#ancova-multiple-intercept-and-slope-model"><i class="fa fa-check"></i><b>5.1.2</b> ANCOVA: multiple intercept AND slope model</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#block-designs"><i class="fa fa-check"></i><b>5.2</b> Block Designs</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#data-prep-and-plotting"><i class="fa fa-check"></i><b>5.2.1</b> Data prep and Plotting</a></li>
<li class="chapter" data-level="5.2.2" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#models-with-block-designs"><i class="fa fa-check"></i><b>5.2.2</b> Models with block designs</a></li>
<li class="chapter" data-level="5.2.3" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#blocks-as-random-effects"><i class="fa fa-check"></i><b>5.2.3</b> Blocks as random effects</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#variance-components"><i class="fa fa-check"></i><b>5.3</b> Variance components</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#r2"><i class="fa fa-check"></i><b>5.3.1</b> R2</a></li>
<li class="chapter" data-level="5.3.2" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#chick-weight-example"><i class="fa fa-check"></i><b>5.3.2</b> Chick weight example</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#split-plot-and-nested-designs"><i class="fa fa-check"></i><b>5.4</b> Split-plot and nested designs</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#additional-nesting"><i class="fa fa-check"></i><b>5.4.1</b> Additional nesting</a></li>
<li class="chapter" data-level="5.4.2" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#r-challenge"><i class="fa fa-check"></i><b>5.4.2</b> R CHALLENGE</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#repeated-measures"><i class="fa fa-check"></i><b>5.5</b> Repeated Measures</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#r-challange---repeated-measures"><i class="fa fa-check"></i><b>5.5.1</b> R CHALLANGE - REPEATED MEASURES</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html#additional-lmm-reading"><i class="fa fa-check"></i><b>5.6</b> Additional LMM reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html"><i class="fa fa-check"></i><b>6</b> Generalized linear mixed models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#poisson-and-nb-glmms"><i class="fa fa-check"></i><b>6.1</b> Poisson and NB GLMMs</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#improving-the-models-whats-next"><i class="fa fa-check"></i><b>6.1.1</b> Improving the models: What’s next?</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#binomial-glmms"><i class="fa fa-check"></i><b>6.2</b> Binomial GLMMs</a></li>
<li class="chapter" data-level="6.3" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#beta-distributions"><i class="fa fa-check"></i><b>6.3</b> Beta Distributions</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#r-challenge-1"><i class="fa fa-check"></i><b>6.3.1</b> R CHALLENGE</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#zero-inflated-models"><i class="fa fa-check"></i><b>6.4</b> Zero-Inflated Models</a></li>
<li class="chapter" data-level="6.5" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#model-app-exercise"><i class="fa fa-check"></i><b>6.5</b> Model App exercise</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Linear models in Agriculture and Natural Resources</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="generalized-linear-models" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Generalized Linear Models<a href="generalized-linear-models.html#generalized-linear-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>After completing this module, students will be able to:</p>
<ul>
<li><p>4.1 Describe common statistical distributions and types of data they generate</p></li>
<li><p>4.2 Analyze data using non-normal distributions in R</p></li>
<li><p>4.3 Evaluate and justify model fit</p></li>
<li><p>4.4 Interpret and report results from statistical analysis</p></li>
</ul>
<div id="overview-of-generalized-linear-models" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Overview of Generalized Linear Models<a href="generalized-linear-models.html#overview-of-generalized-linear-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Generalized linear models (GLMs) are a class of linear-based regression models developed to handle varying types of error distributions. These class of models are extremely useful for data types that may not conform to what is typically expected given Gaussian expectations or assumptions. For example, data that is binary (e.g. 0 or 1, alive or dead) or count data that is never negative all have different properties. While data transformations prior to model implementation can be done, it may be difficult to interpret results or may not help in meeting the assumptions of the model. In this section we first start with basic data transformations that can be applied to ordinary linear models and then move into different types of GLMs.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="generalized-linear-models.html#cb231-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb231-2"><a href="generalized-linear-models.html#cb231-2" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb231-3"><a href="generalized-linear-models.html#cb231-3" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb231-4"><a href="generalized-linear-models.html#cb231-4" tabindex="-1"></a><span class="fu">library</span>(agridat)</span>
<span id="cb231-5"><a href="generalized-linear-models.html#cb231-5" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb231-6"><a href="generalized-linear-models.html#cb231-6" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code></pre></div>
<div id="example-one-way-anova-with-non-normal-data" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Example: One-way ANOVA with non-normal data<a href="generalized-linear-models.html#example-one-way-anova-with-non-normal-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this example we will run an ANOVA with non-normal data. To do this we first must load the InsectSprays data:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="generalized-linear-models.html#cb232-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;InsectSprays&quot;</span>)<span class="co"># available from base R  </span></span></code></pre></div>
<p>Now we need to filter the data to just 4 treatments (A, B, C, F):</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="generalized-linear-models.html#cb233-1" tabindex="-1"></a>d <span class="ot">&lt;-</span> InsectSprays <span class="sc">%&gt;%</span> <span class="fu">filter</span>(spray<span class="sc">==</span><span class="st">&#39;A&#39;</span><span class="sc">|</span>spray<span class="sc">==</span><span class="st">&#39;B&#39;</span><span class="sc">|</span>spray<span class="sc">==</span><span class="st">&#39;C&#39;</span><span class="sc">|</span>spray<span class="sc">==</span><span class="st">&#39;F&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb233-2"><a href="generalized-linear-models.html#cb233-2" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span></code></pre></div>
<p>Let’s plot out data:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="generalized-linear-models.html#cb234-1" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x=</span>spray,<span class="at">y=</span>count)) <span class="sc">+</span> </span>
<span id="cb234-2"><a href="generalized-linear-models.html#cb234-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">width =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb234-3"><a href="generalized-linear-models.html#cb234-3" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">height=</span><span class="dv">0</span>,<span class="at">width=</span>.<span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">pch =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb234-4"><a href="generalized-linear-models.html#cb234-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Spray Treatment Type&quot;</span>,</span>
<span id="cb234-5"><a href="generalized-linear-models.html#cb234-5" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb234-6"><a href="generalized-linear-models.html#cb234-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb234-7"><a href="generalized-linear-models.html#cb234-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span> <span class="st">&#39;bold&#39;</span>, <span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb234-8"><a href="generalized-linear-models.html#cb234-8" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face=</span> <span class="st">&#39;bold&#39;</span>, <span class="at">size =</span> <span class="dv">15</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-4"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-4-1.png" alt="Insect count data by spray type" width="672" />
<p class="caption">
Figure 2.1: Insect count data by spray type
</p>
</div>
<p>Let’s examine a histogram of the response variable ‘count’.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="generalized-linear-models.html#cb235-1" tabindex="-1"></a><span class="fu">hist</span>(d<span class="sc">$</span>count)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-5"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-5-1.png" alt="Histogram of insect counts." width="672" />
<p class="caption">
Figure 2.2: Histogram of insect counts.
</p>
</div>
<p>The distribution is not visually normal but remember, with linear models the assumption of normality is not necessarily with the response variable but is instead about the errors (residuals of the model). Therefore, this histogram can hint of what sort of transformations we may want to use to have a model that better meets assumptions.</p>
<p>While not ideal let’s construct a linear model to examine the effect of the different sprays on insect counts without executing any data transformations or applying fancy GLMs:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="generalized-linear-models.html#cb236-1" tabindex="-1"></a>lm1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(count<span class="sc">~</span>spray, <span class="at">data=</span>d)</span>
<span id="cb236-2"><a href="generalized-linear-models.html#cb236-2" tabindex="-1"></a><span class="fu">Anova</span>(lm1, <span class="at">type=</span><span class="dv">2</span>)  <span class="do">## car::Anova will print out an ANOVA table</span></span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: count
##        Chisq Df Pr(&gt;Chisq)    
## spray 86.656  3  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Let’s check the residuals of the model:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="generalized-linear-models.html#cb238-1" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(lm1)) <span class="co">#&#39; residuals should be normally distributed, even for glm</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-7-1"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-7-1.png" alt="Residual plots." width="672" />
<p class="caption">
Figure 4.1: Residual plots.
</p>
</div>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="generalized-linear-models.html#cb239-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">resid</span>(lm1)<span class="sc">~</span><span class="fu">fitted</span>(lm1))   <span class="do">## residuals should be evenly dispersed around 0 across the range of x&#39;s</span></span>
<span id="cb239-2"><a href="generalized-linear-models.html#cb239-2" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)     <span class="co"># funnel shapes or curvature is bad</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-7-2"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-7-2.png" alt="Residual plots." width="672" />
<p class="caption">
Figure 4.2: Residual plots.
</p>
</div>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="generalized-linear-models.html#cb240-1" tabindex="-1"></a><span class="fu">qqPlot</span>(<span class="fu">resid</span>(lm1))  <span class="do">## residuals should line up pretty closely to the blue line</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-8"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-8-1.png" alt="QQ plot" width="672" />
<p class="caption">
Figure 2.5: QQ plot
</p>
</div>
<pre><code>## [1] 45 46</code></pre>
<p>Normality of the residuals would pass an eye check. However when we look at the variance of the residuals across spray treatment types we see evidence of violation where the variances are not necessarily homogeneous for each group:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="generalized-linear-models.html#cb242-1" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(lm1) <span class="sc">~</span> d<span class="sc">$</span>spray)  <span class="do">## variances should be homogeneous for each group</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-9"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-9-1.png" alt="Boxplot of residuals to check for heterogeneity." width="672" />
<p class="caption">
Figure 4.3: Boxplot of residuals to check for heterogeneity.
</p>
</div>
<p>Let’s use emmeans to calculate model means and confidence intervals.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="generalized-linear-models.html#cb243-1" tabindex="-1"></a><span class="fu">emmeans</span>(lm1, <span class="sc">~</span>spray)</span></code></pre></div>
<pre><code>##  spray emmean   SE df lower.CL upper.CL
##  A      14.50 1.26 43   11.961    17.04
##  B      15.33 1.26 43   12.794    17.87
##  C       2.08 1.26 43   -0.456     4.62
##  F      16.67 1.26 43   14.127    19.21
## 
## Confidence level used: 0.95</code></pre>
<p>Note all the standard error estimates are the same and the lower CL can be negative (although we know that counts can never be negative). Is this ok?</p>
</div>
<div id="log-linear-model" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Log-linear model<a href="generalized-linear-models.html#log-linear-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now let’s use a log-linear model to examine the effect of the different sprays on insect counts. To implement a log-linear model we can log transform the counts with the <code>log()</code> function. Note that the this function applies a natural logarithmic transformation to the specified variable or vector. If you want to use a base 10 logarithmic transformation then the correct function to use would be <code>log10</code>. Notice add 1 to the variable before the transformation because log(0) is undefined. You could add any small constant (e.g. 0.01 or 0.0001) but +1 is convenient because zeros go back to zero after the transformation.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="generalized-linear-models.html#cb245-1" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] -Inf</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="generalized-linear-models.html#cb247-1" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="generalized-linear-models.html#cb249-1" tabindex="-1"></a>lm2 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(<span class="fu">log</span>(count<span class="sc">+</span><span class="dv">1</span>)<span class="sc">~</span>spray, <span class="at">data=</span>d)</span>
<span id="cb249-2"><a href="generalized-linear-models.html#cb249-2" tabindex="-1"></a><span class="fu">Anova</span>(lm2, <span class="at">type=</span><span class="dv">2</span>)  <span class="do">## car::Anova will print out an ANOVA table testing</span></span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: log(count + 1)
##       Chisq Df Pr(&gt;Chisq)    
## spray 185.5  3  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Let’s check residuals:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="generalized-linear-models.html#cb251-1" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(lm2)) <span class="do">## residuals should be normally distributed, even for glm</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-13-1"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-13-1.png" alt="Residual plots." width="672" />
<p class="caption">
Figure 4.4: Residual plots.
</p>
</div>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="generalized-linear-models.html#cb252-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">resid</span>(lm2)<span class="sc">~</span><span class="fu">fitted</span>(lm2)) <span class="sc">+</span>  <span class="do">## residuals should be evenly dispersed around 0 across the range of x&#39;s</span></span>
<span id="cb252-2"><a href="generalized-linear-models.html#cb252-2" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)                               <span class="co"># funnel shapes or curvature is bad</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-13-2"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-13-2.png" alt="Residual plots." width="672" />
<p class="caption">
Figure 4.5: Residual plots.
</p>
</div>
<pre><code>## integer(0)</code></pre>
<p>Let’s plot the QQplot and boxplots next:</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="generalized-linear-models.html#cb254-1" tabindex="-1"></a><span class="fu">qqPlot</span>(<span class="fu">resid</span>(lm2))  <span class="do">## residuals should line up pretty closely to the blue line</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-14-1"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-14-1.png" alt="QQ and box plots." width="672" />
<p class="caption">
Figure 4.6: QQ and box plots.
</p>
</div>
<pre><code>## [1] 27 25</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="generalized-linear-models.html#cb256-1" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(lm2) <span class="sc">~</span> d<span class="sc">$</span>spray)  <span class="do">## variances should be homogeneous for each group</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-14-2"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-14-2.png" alt="QQ and box plots." width="672" />
<p class="caption">
Figure 4.7: QQ and box plots.
</p>
</div>
<p>We can see above that the transformation makes the homogeneity of the residuals a little but more constant and consistent across treatment types. This seems to help especially treatment C relative to the model without the log transformation. However, the residuals of treatment C are still highly variable compared to treatments A, B, and C.</p>
<p>Let’s use emmeans again:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="generalized-linear-models.html#cb257-1" tabindex="-1"></a><span class="fu">emmeans</span>(lm2, <span class="sc">~</span>spray) <span class="do">## note that all means still transformd to be on the log-scale</span></span></code></pre></div>
<pre><code>##  spray emmean    SE df lower.CL upper.CL
##  A      2.697 0.115 43    2.465     2.93
##  B      2.757 0.115 43    2.525     2.99
##  C      0.953 0.115 43    0.721     1.18
##  F      2.816 0.115 43    2.584     3.05
## 
## Results are given on the log(mu + 1) (not the response) scale. 
## Confidence level used: 0.95</code></pre>
<p>Note that the means are now on the log-transformed scale, as pointed out at the bottom on the emmeans table. Usually we want to back-transform the means to the original scale so they are easier to interpret. To calculate back-transformed means with ‘emmeans’ we can add additional arguments to the function:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="generalized-linear-models.html#cb259-1" tabindex="-1"></a><span class="fu">emmeans</span>(lm2, <span class="sc">~</span>spray, <span class="at">type=</span><span class="st">&#39;response&#39;</span>) <span class="do">## note that now all means are back-transformed</span></span></code></pre></div>
<pre><code>##  spray response    SE df lower.CL upper.CL
##  A        13.83 1.700 43    10.76    17.70
##  B        14.75 1.810 43    11.49    18.85
##  C         1.59 0.298 43     1.06     2.27
##  F        15.70 1.920 43    12.25    20.06
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log(mu + 1) scale</code></pre>
<p>Now notice how the means columns has been relabeled response and is in the same units that we originally started with.</p>
</div>
<div id="generalized-linear-models-glms" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Generalized linear models (GLMs)<a href="generalized-linear-models.html#generalized-linear-models-glms" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now let’s use GLMs to examine the effect of the different sprays:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="generalized-linear-models.html#cb261-1" tabindex="-1"></a>glm1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(count<span class="sc">~</span>spray, <span class="at">data=</span>d, <span class="at">family=</span><span class="st">&#39;poisson&#39;</span>) </span></code></pre></div>
<p>The nice thing about using <code>glmmTMB()</code> is that it is a general function that conducts can a <em>generalized</em> linear model. To do this, we simply specify the ‘family’ (aka error distribution). The default is the ‘Gaussian’ distribution (normal), so if we don’t specify a family it run a simple linear model. In the example above we implement a Poisson distribution, a distribution that is frequently used with count data. All the model “calculations” are saved in an object we called ‘glm1’. An alternative to the <code>glmmTMB()</code> function is <code>glm()</code> which is available in base R.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="generalized-linear-models.html#cb262-1" tabindex="-1"></a><span class="fu">Anova</span>(glm1, <span class="at">type=</span><span class="dv">2</span>)  <span class="do">## car::Anova will print out an ANOVA table testing </span></span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: count
##        Chisq Df Pr(&gt;Chisq)    
## spray 98.376  3  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>For the ANOVA table above, the null hypothesis that all group means are equal. The argument, type = 2, provides margin tests, which is usually better than the default Type I, especially for more complicated models (See 2.3.1 Box 3 for additional information about the type 2 method). For GLMs, Anova returns a likelihood ratio test with a chi-sq value.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="generalized-linear-models.html#cb264-1" tabindex="-1"></a><span class="fu">summary</span>(glm1)   <span class="do">## summary() will provide the model coefficients (ie. the &quot;guts&quot; of the model)</span></span></code></pre></div>
<pre><code>##  Family: poisson  ( log )
## Formula:          count ~ spray
## Data: d
## 
##      AIC      BIC   logLik deviance df.resid 
##    273.9    281.4   -133.0    265.9       44 
## 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  2.67415    0.07581   35.27   &lt;2e-16 ***
## sprayB       0.05588    0.10574    0.53    0.597    
## sprayC      -1.94018    0.21389   -9.07   &lt;2e-16 ***
## sprayF       0.13926    0.10367    1.34    0.179    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The coefficients allow you rebuild the means from the linear model, just like we did in 2.3. In this case, rebuilding the model from the coefficients is not super helpful because they are still on the log-scale and the p-values aren’t as meaningful. Residual deviance should be about equal to the degrees of freedom. More than twice as high is problematic (note: we will come back to this problem when we discuss “overdispersion” in the next section).</p>
<p>Now let’s check assumptions of model by examining residuals:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="generalized-linear-models.html#cb266-1" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(glm1)) <span class="do">## residuals should be normally distributed, but don&#39;t need to be for GLMs</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-20-1"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-20-1.png" alt="Residual plots." width="672" />
<p class="caption">
Figure 4.8: Residual plots.
</p>
</div>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="generalized-linear-models.html#cb267-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">resid</span>(glm1)<span class="sc">~</span><span class="fu">fitted</span>(glm1))  <span class="do">## residuals should be evenly dispersed around 0 across the range of x&#39;s</span></span>
<span id="cb267-2"><a href="generalized-linear-models.html#cb267-2" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)                               <span class="co"># funnel shapes or curvature is bad</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-20-2"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-20-2.png" alt="Residual plots." width="672" />
<p class="caption">
Figure 4.9: Residual plots.
</p>
</div>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="generalized-linear-models.html#cb268-1" tabindex="-1"></a><span class="fu">qqPlot</span>(<span class="fu">resid</span>(glm1))  <span class="do">## calls from car package, residuals should line up pretty closely to the blue line</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-21-1"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-21-1.png" alt="QQ and box plots." width="672" />
<p class="caption">
Figure 4.10: QQ and box plots.
</p>
</div>
<pre><code>## [1] 45 46</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="generalized-linear-models.html#cb270-1" tabindex="-1"></a><span class="co"># points that drift from line might be outliers</span></span>
<span id="cb270-2"><a href="generalized-linear-models.html#cb270-2" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(glm1) <span class="sc">~</span> d<span class="sc">$</span>spray)  <span class="do">## variances should be homogeneous for each group</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-21-2"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-21-2.png" alt="QQ and box plots." width="672" />
<p class="caption">
Figure 4.11: QQ and box plots.
</p>
</div>
<p>Above, we see further improvement in the residual variances across treatment types. Diagnosing complex GLMs can be very difficult. Residuals are often NOT NORMALLY DISTRIBUTED, even though they should be. We will return to this later.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="generalized-linear-models.html#cb271-1" tabindex="-1"></a><span class="fu">emmeans</span>(glm1, <span class="sc">~</span>spray) <span class="do">## emmeans::emmmeans will rebuild the model for you</span></span></code></pre></div>
<pre><code>##  spray emmean     SE  df asymp.LCL asymp.UCL
##  A      2.674 0.0758 Inf     2.526      2.82
##  B      2.730 0.0737 Inf     2.586      2.87
##  C      0.734 0.2000 Inf     0.342      1.13
##  F      2.813 0.0707 Inf     2.675      2.95
## 
## Results are given on the log (not the response) scale. 
## Confidence level used: 0.95</code></pre>
<p>The emmeans code above will print off the means, SE, and confidence intervals for each treatment group. Note, the coefficients are on the log-scale (look at model specifications of glm1 object).</p>
<p>We can also use <code>emmeans()</code> to make pairwise comparisons to directly compare each spray to the others.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="generalized-linear-models.html#cb273-1" tabindex="-1"></a><span class="fu">emmeans</span>(glm1, pairwise<span class="sc">~</span>spray, <span class="at">type=</span><span class="st">&#39;response&#39;</span>)  <span class="do">## adding &#39;pairwise&#39; will conduct pairwise contrasts -- ie. compare each group mean to the others</span></span></code></pre></div>
<pre><code>## $emmeans
##  spray  rate    SE  df asymp.LCL asymp.UCL
##  A     14.50 1.100 Inf     12.50     16.82
##  B     15.33 1.130 Inf     13.27     17.72
##  C      2.08 0.417 Inf      1.41      3.08
##  F     16.67 1.180 Inf     14.51     19.14
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale 
## 
## $contrasts
##  contrast ratio     SE  df null z.ratio p.value
##  A / B    0.946 0.1000 Inf    1  -0.528  0.9522
##  A / C    6.960 1.4900 Inf    1   9.071  &lt;.0001
##  A / F    0.870 0.0902 Inf    1  -1.343  0.5352
##  B / C    7.360 1.5700 Inf    1   9.364  &lt;.0001
##  B / F    0.920 0.0940 Inf    1  -0.816  0.8468
##  C / F    0.125 0.0265 Inf    1  -9.803  &lt;.0001
## 
## P value adjustment: tukey method for comparing a family of 4 estimates 
## Tests are performed on the log scale</code></pre>
<p>Adding the argument ‘pairwise’ will conduct pairwise contrasts – ie. compare each group mean to the others. This automatically adjusts p-values using the ‘tukey’ adjust. This can be changed using ‘adjust=XX’ within the <code>emmeans()</code> function. The type=‘response’ will back-transform (i.e. in this case, exponentiate) to the original scale</p>
<p>Let’s compare residuals for normal, log-transformed, and poisson models:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="generalized-linear-models.html#cb275-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)) <span class="co">#allow plots to be shown in three</span></span>
<span id="cb275-2"><a href="generalized-linear-models.html#cb275-2" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(lm1) <span class="sc">~</span> d<span class="sc">$</span>spray, <span class="at">main =</span> <span class="st">&quot;Linear&quot;</span>) </span>
<span id="cb275-3"><a href="generalized-linear-models.html#cb275-3" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(lm2) <span class="sc">~</span> d<span class="sc">$</span>spray, <span class="at">main =</span> <span class="st">&quot;Log-Linear&quot;</span>) </span>
<span id="cb275-4"><a href="generalized-linear-models.html#cb275-4" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(glm1) <span class="sc">~</span> d<span class="sc">$</span>spray, <span class="at">main =</span> <span class="st">&quot;GLM&quot;</span>) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-24"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-24-1.png" alt="Residual plots for all models." width="672" />
<p class="caption">
Figure 2.19: Residual plots for all models.
</p>
</div>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="generalized-linear-models.html#cb276-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)) <span class="co">#return to default</span></span></code></pre></div>
<p>Let’s also compare means for normal, log-transformed, and poisson models:</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="generalized-linear-models.html#cb277-1" tabindex="-1"></a><span class="fu">emmeans</span>(lm1, <span class="sc">~</span>spray)</span></code></pre></div>
<pre><code>##  spray emmean   SE df lower.CL upper.CL
##  A      14.50 1.26 43   11.961    17.04
##  B      15.33 1.26 43   12.794    17.87
##  C       2.08 1.26 43   -0.456     4.62
##  F      16.67 1.26 43   14.127    19.21
## 
## Confidence level used: 0.95</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="generalized-linear-models.html#cb279-1" tabindex="-1"></a><span class="fu">emmeans</span>(lm2, <span class="sc">~</span>spray, <span class="at">type=</span><span class="st">&#39;response&#39;</span>)</span></code></pre></div>
<pre><code>##  spray response    SE df lower.CL upper.CL
##  A        13.83 1.700 43    10.76    17.70
##  B        14.75 1.810 43    11.49    18.85
##  C         1.59 0.298 43     1.06     2.27
##  F        15.70 1.920 43    12.25    20.06
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log(mu + 1) scale</code></pre>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="generalized-linear-models.html#cb281-1" tabindex="-1"></a><span class="fu">emmeans</span>(glm1, <span class="sc">~</span>spray, <span class="at">type=</span><span class="st">&#39;response&#39;</span>)</span></code></pre></div>
<pre><code>##  spray  rate    SE  df asymp.LCL asymp.UCL
##  A     14.50 1.100 Inf     12.50     16.82
##  B     15.33 1.130 Inf     13.27     17.72
##  C      2.08 0.417 Inf      1.41      3.08
##  F     16.67 1.180 Inf     14.51     19.14
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale</code></pre>
<p>What model do you think we should go with?</p>
</div>
</div>
<div id="overdispersion" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Overdispersion<a href="generalized-linear-models.html#overdispersion" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section we will go over how to deal with overdispersion. While overdispersion is covered more extensively in the lecture portion of the class, we will quickly outline what it is.</p>
<p>Overdispersion is when variation is higher than what would be expected. A great example of how overdispersion would biologically come about in a given dataset is found from this <a href="http://biometry.github.io/APES//LectureNotes/2016-JAGS/Overdispersion/OverdispersionJAGS.html">website</a>. To summarize it briefly, imagine if you are collecting tree seedlings within a forest. These seedlings are naturally not uniformly distributed throughout the forest area. Instead they are more likely clumped, where most plots don’t have any seedlings but a few have a ton. Therefore your counts of seedlings for a given plot can vary from 0 to numbers that are extremely high. This sort of variation can cause overdispersion to be observed in the model if it is not appropriately accounted for.</p>
<p>Let’s load the necessary libraries:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="generalized-linear-models.html#cb283-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb283-2"><a href="generalized-linear-models.html#cb283-2" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb283-3"><a href="generalized-linear-models.html#cb283-3" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb283-4"><a href="generalized-linear-models.html#cb283-4" tabindex="-1"></a><span class="fu">library</span>(agridat)</span>
<span id="cb283-5"><a href="generalized-linear-models.html#cb283-5" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span></code></pre></div>
<p>Load in and read about the <code>beall.webworms</code> dataset. The variables of interest are the y=count of webworms, spray = spray treatment, and lead = lead pesticide treatment. Don’t worry about the block or other variables for now.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="generalized-linear-models.html#cb284-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;beall.webworms&quot;</span>)</span>
<span id="cb284-2"><a href="generalized-linear-models.html#cb284-2" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> beall.webworms</span>
<span id="cb284-3"><a href="generalized-linear-models.html#cb284-3" tabindex="-1"></a>?beall.webworms</span></code></pre></div>
<pre><code>## starting httpd help server ... done</code></pre>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="generalized-linear-models.html#cb286-1" tabindex="-1"></a><span class="fu">head</span>(d1)</span></code></pre></div>
<pre><code>##   row col y block trt spray lead
## 1   1   1 1    B1  T1     N    N
## 2   2   1 0    B1  T1     N    N
## 3   3   1 1    B1  T1     N    N
## 4   4   1 3    B1  T1     N    N
## 5   5   1 6    B1  T1     N    N
## 6   6   1 0    B2  T1     N    N</code></pre>
<p>Let’s examine and plot the data:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="generalized-linear-models.html#cb288-1" tabindex="-1"></a><span class="fu">ggplot</span>(d1, <span class="fu">aes</span>(<span class="at">x=</span>spray, <span class="at">y=</span>y, <span class="at">fill=</span>lead)) <span class="sc">+</span> </span>
<span id="cb288-2"><a href="generalized-linear-models.html#cb288-2" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">scale=</span><span class="st">&quot;width&quot;</span>, <span class="at">adjust=</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb288-3"><a href="generalized-linear-models.html#cb288-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitterdodge</span>(<span class="at">jitter.width=</span>.<span class="dv">5</span>,</span>
<span id="cb288-4"><a href="generalized-linear-models.html#cb288-4" tabindex="-1"></a>                                             <span class="at">jitter.height=</span>.<span class="dv">1</span>,</span>
<span id="cb288-5"><a href="generalized-linear-models.html#cb288-5" tabindex="-1"></a>                                             <span class="at">dodge.width =</span> <span class="dv">1</span>),</span>
<span id="cb288-6"><a href="generalized-linear-models.html#cb288-6" tabindex="-1"></a>             <span class="at">alpha=</span>.<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb288-7"><a href="generalized-linear-models.html#cb288-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-29"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-29-1.png" alt="Plot of webworm data." width="672" />
<p class="caption">
Figure 2.23: Plot of webworm data.
</p>
</div>
<p>Let’s now run a model with the interaction of spray and lead. Its count data, so lets assume a Poisson distribution.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="generalized-linear-models.html#cb289-1" tabindex="-1"></a>r3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> spray <span class="sc">*</span> lead, <span class="at">data=</span>d1, <span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span></code></pre></div>
<p>Examine the model summary:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="generalized-linear-models.html#cb290-1" tabindex="-1"></a><span class="fu">summary</span>(r3)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ spray * lead, family = &quot;poisson&quot;, data = d1)
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   0.33647    0.04688   7.177 7.12e-13 ***
## sprayY       -1.02043    0.09108 -11.204  &lt; 2e-16 ***
## leadY        -0.49628    0.07621  -6.512 7.41e-11 ***
## sprayY:leadY  0.29425    0.13917   2.114   0.0345 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 1955.9  on 1299  degrees of freedom
## Residual deviance: 1720.4  on 1296  degrees of freedom
## AIC: 3125.5
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="generalized-linear-models.html#cb292-1" tabindex="-1"></a><span class="fu">Anova</span>(r3)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: y
##            LR Chisq Df Pr(&gt;Chisq)    
## spray       188.707  1  &lt; 2.2e-16 ***
## lead         42.294  1  7.853e-11 ***
## spray:lead    4.452  1    0.03485 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="generalized-linear-models.html#cb294-1" tabindex="-1"></a><span class="fu">emmeans</span>(r3, <span class="sc">~</span>spray<span class="sc">:</span>lead, <span class="at">type=</span><span class="st">&#39;response&#39;</span>) </span></code></pre></div>
<pre><code>##  spray lead  rate     SE  df asymp.LCL asymp.UCL
##  N     N    1.400 0.0656 Inf     1.277     1.535
##  Y     N    0.505 0.0394 Inf     0.433     0.588
##  N     Y    0.852 0.0512 Inf     0.758     0.959
##  Y     Y    0.412 0.0356 Inf     0.348     0.488
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale</code></pre>
<p>We need to load library(performance) to test for overdispersion:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="generalized-linear-models.html#cb296-1" tabindex="-1"></a><span class="fu">library</span>(performance)</span></code></pre></div>
<pre><code>## Warning: package &#39;performance&#39; was built under R version 4.3.3</code></pre>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="generalized-linear-models.html#cb298-1" tabindex="-1"></a><span class="fu">check_overdispersion</span>(r3) <span class="co"># overdispersion ratio calculator from performance package</span></span></code></pre></div>
<pre><code>## # Overdispersion test
## 
##        dispersion ratio =    1.355
##   Pearson&#39;s Chi-Squared = 1755.717
##                 p-value =  &lt; 0.001</code></pre>
<pre><code>## Overdispersion detected.</code></pre>
<p>Note that there is overdispersion and the “dispersion ratio = 1.355”, which is (approximately) the <strong>Residual deviance</strong> over the <strong>degrees of freedom</strong> from the <code>summary()</code> printout.</p>
<p>Now let’s implement the negative binomial distribution, which will account for the overdispersion in the data.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="generalized-linear-models.html#cb301-1" tabindex="-1"></a>r4 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> spray <span class="sc">*</span> lead, <span class="at">data=</span>d1, <span class="at">family=</span><span class="st">&quot;nbinom2&quot;</span>)</span>
<span id="cb301-2"><a href="generalized-linear-models.html#cb301-2" tabindex="-1"></a><span class="fu">Anova</span>(r4)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: y
##               Chisq Df Pr(&gt;Chisq)    
## spray      125.5047  1  &lt; 2.2e-16 ***
## lead        26.8005  1  2.256e-07 ***
## spray:lead   3.3942  1    0.06542 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="generalized-linear-models.html#cb303-1" tabindex="-1"></a><span class="fu">emmeans</span>(r4, <span class="sc">~</span>spray<span class="sc">:</span>lead, <span class="at">type=</span><span class="st">&#39;response&#39;</span>) </span></code></pre></div>
<pre><code>##  spray lead response     SE  df asymp.LCL asymp.UCL
##  N     N       1.400 0.0855 Inf     1.242     1.578
##  Y     N       0.505 0.0441 Inf     0.425     0.599
##  N     Y       0.852 0.0611 Inf     0.741     0.981
##  Y     Y       0.412 0.0391 Inf     0.342     0.497
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale</code></pre>
<p>Let’s use the DHARMa package to simulate residuals for poisson and negative binomial models.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="generalized-linear-models.html#cb305-1" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span></code></pre></div>
<pre><code>## Warning: package &#39;DHARMa&#39; was built under R version 4.3.3</code></pre>
<pre><code>## This is DHARMa 0.4.7. For overview type &#39;?DHARMa&#39;. For recent changes, type news(package = &#39;DHARMa&#39;)</code></pre>
<p>We can interpret the simulated residuals very similarly to the raw residuals we have previously examined. The residuals should line up along the line in the QQ plot and there should be (roughly) equal scatter in the residuals among the groups. First let’s look at simulated residuals from the Poisson model:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="generalized-linear-models.html#cb308-1" tabindex="-1"></a><span class="fu">simulateResiduals</span>(r3, <span class="at">plot=</span>T) <span class="do">## plot simulated residuals</span></span></code></pre></div>
<pre><code>## DHARMa:testOutliers with type = binomial may have inflated Type I error rates for integer-valued distributions. To get a more exact result, it is recommended to re-run testOutliers with type = &#39;bootstrap&#39;. See ?testOutliers for details</code></pre>
<p><img src="03-Module_4_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<pre><code>## Object of Class DHARMa with simulated residuals based on 250 simulations with refit = FALSE . See ?DHARMa::simulateResiduals for help. 
##  
## Scaled residual values: 0.4574871 0.1249353 0.3765507 0.8898169 0.9947878 0.1384856 0.8427982 0.7401398 0.5451185 0.9247921 0.04867315 0.9158836 0.4210366 0.2450423 0.6110091 0.05695033 0.5344315 0.9367373 0.8666021 0.7861569 ...</code></pre>
<p>Histograms of the simulated residuals will be different than before. Here the simulated residuals should be flat. Its ok if the bars bump up and down, but they should be on average flat across the graph.The bars shouldn’t be peaked (eg. “normally” distributed) or U-shaped or increasing/decreasing.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="generalized-linear-models.html#cb311-1" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">simulateResiduals</span>(r3)) <span class="do">## histogram should be flat</span></span></code></pre></div>
<p><img src="03-Module_4_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>The residuals from the Poisson model look ok, but not perfect. The line in the QQ plot deviates from 1:1 and the variances are a little different among the groups. The histogram looks ok.</p>
<p>Now let’s look at residuals for negative binomial model:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="generalized-linear-models.html#cb312-1" tabindex="-1"></a><span class="fu">simulateResiduals</span>(r4, <span class="at">plot=</span>T) <span class="do">## plot simulated residuals</span></span></code></pre></div>
<p><img src="03-Module_4_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<pre><code>## Object of Class DHARMa with simulated residuals based on 250 simulations with refit = FALSE . See ?DHARMa::simulateResiduals for help. 
##  
## Scaled residual values: 0.4821899 0.2591288 0.3967079 0.8858496 0.992 0.117201 0.7325008 0.6766148 0.4083655 0.8192085 0.10593 0.8988023 0.621979 0.3468156 0.7885132 0.2689479 0.657901 0.92479 0.7941977 0.8523115 ...</code></pre>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="generalized-linear-models.html#cb314-1" tabindex="-1"></a><span class="fu">simulateResiduals</span>(r4, <span class="at">hist=</span>T) <span class="do">## histogram should be flat</span></span></code></pre></div>
<pre><code>## Object of Class DHARMa with simulated residuals based on 250 simulations with refit = FALSE . See ?DHARMa::simulateResiduals for help. 
##  
## Scaled residual values: 0.4821899 0.2591288 0.3967079 0.8858496 0.992 0.117201 0.7325008 0.6766148 0.4083655 0.8192085 0.10593 0.8988023 0.621979 0.3468156 0.7885132 0.2689479 0.657901 0.92479 0.7941977 0.8523115 ...</code></pre>
</div>
<div id="binomial-glm" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Binomial GLM<a href="generalized-linear-models.html#binomial-glm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section we will run a GLM with a binomial error distribution. We load the following packages:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="generalized-linear-models.html#cb316-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb316-2"><a href="generalized-linear-models.html#cb316-2" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb316-3"><a href="generalized-linear-models.html#cb316-3" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb316-4"><a href="generalized-linear-models.html#cb316-4" tabindex="-1"></a><span class="fu">library</span>(agridat)</span>
<span id="cb316-5"><a href="generalized-linear-models.html#cb316-5" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb316-6"><a href="generalized-linear-models.html#cb316-6" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb316-7"><a href="generalized-linear-models.html#cb316-7" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code></pre></div>
<p>We will use the Titanic survival dataset for the binomial GLM.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="generalized-linear-models.html#cb317-1" tabindex="-1"></a><span class="do">## LOAD TITANIC SURVIVAL DATASET</span></span>
<span id="cb317-2"><a href="generalized-linear-models.html#cb317-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;TitanicSurvival&quot;</span>)</span>
<span id="cb317-3"><a href="generalized-linear-models.html#cb317-3" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> TitanicSurvival <span class="sc">%&gt;%</span> <span class="fu">filter</span>(age<span class="sc">&gt;</span><span class="dv">17</span>) <span class="co"># filter out children</span></span>
<span id="cb317-4"><a href="generalized-linear-models.html#cb317-4" tabindex="-1"></a><span class="fu">head</span>(t1)</span></code></pre></div>
<pre><code>##                                 survived    sex age passengerClass
## Allen, Miss. Elisabeth Walton        yes female  29            1st
## Allison, Mr. Hudson Joshua Crei       no   male  30            1st
## Allison, Mrs. Hudson J C (Bessi       no female  25            1st
## Anderson, Mr. Harry                  yes   male  48            1st
## Andrews, Miss. Kornelia Theodos      yes female  63            1st
## Andrews, Mr. Thomas Jr                no   male  39            1st</code></pre>
<p>Let’s quickly plot the data:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="generalized-linear-models.html#cb319-1" tabindex="-1"></a><span class="fu">ggplot</span>(t1, <span class="fu">aes</span>(<span class="at">x=</span>passengerClass, <span class="at">y=</span>survived, <span class="at">color=</span>sex)) <span class="sc">+</span></span>
<span id="cb319-2"><a href="generalized-linear-models.html#cb319-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">height=</span>.<span class="dv">2</span>, <span class="at">width=</span><span class="fl">0.2</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-40"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-40-1.png" alt="Plot of titanic survival data." width="672" />
<p class="caption">
Figure 2.34: Plot of titanic survival data.
</p>
</div>
<p>Now we can construct a GLM to estimate survival as a function of sex and passengerClass while include Age as co-variate.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="generalized-linear-models.html#cb320-1" tabindex="-1"></a>tglm1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(survived <span class="sc">~</span> sex <span class="sc">*</span> passengerClass <span class="sc">+</span> age, <span class="at">data=</span>t1, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<p>Let’s look at the ANOVA table and summary of the model:</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="generalized-linear-models.html#cb321-1" tabindex="-1"></a><span class="do">## print off anova table</span></span>
<span id="cb321-2"><a href="generalized-linear-models.html#cb321-2" tabindex="-1"></a><span class="fu">Anova</span>(tglm1)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: survived
##                       Chisq Df Pr(&gt;Chisq)    
## sex                141.6195  1  &lt; 2.2e-16 ***
## passengerClass      54.3629  2  1.568e-12 ***
## age                  8.0343  1    0.00459 ** 
## sex:passengerClass  42.2193  2  6.795e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="generalized-linear-models.html#cb323-1" tabindex="-1"></a><span class="do">## print off summary</span></span>
<span id="cb323-2"><a href="generalized-linear-models.html#cb323-2" tabindex="-1"></a><span class="fu">summary</span>(tglm1)</span></code></pre></div>
<pre><code>##  Family: binomial  ( logit )
## Formula:          survived ~ sex * passengerClass + age
## Data: t1
## 
##      AIC      BIC   logLik deviance df.resid 
##    766.4    799.9   -376.2    752.4      885 
## 
## 
## Conditional model:
##                            Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                4.440407   0.637348   6.967 3.24e-12 ***
## sexmale                   -4.105509   0.540239  -7.599 2.97e-14 ***
## passengerClass2nd         -1.709637   0.609584  -2.805  0.00504 ** 
## passengerClass3rd         -3.957656   0.562162  -7.040 1.92e-12 ***
## age                       -0.025352   0.008944  -2.834  0.00459 ** 
## sexmale:passengerClass2nd -0.203859   0.698880  -0.292  0.77052    
## sexmale:passengerClass3rd  2.655928   0.597514   4.445 8.79e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Now we can check residuals:</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="generalized-linear-models.html#cb325-1" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">resid</span>(tglm1)) <span class="do">## residuals should be normally distributed, even for glm</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-43-1"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-43-1.png" alt="Residual plots." width="672" />
<p class="caption">
Figure 4.12: Residual plots.
</p>
</div>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="generalized-linear-models.html#cb326-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">resid</span>(tglm1)<span class="sc">~</span><span class="fu">fitted</span>(tglm1)) <span class="sc">+</span>  <span class="do">## residuals should be evenly dispersed around 0 across the range of x&#39;s</span></span>
<span id="cb326-2"><a href="generalized-linear-models.html#cb326-2" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)                               <span class="co"># funnel shapes or curvature is bad</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-43-2"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-43-2.png" alt="Residual plots." width="672" />
<p class="caption">
Figure 4.13: Residual plots.
</p>
</div>
<pre><code>## integer(0)</code></pre>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="generalized-linear-models.html#cb328-1" tabindex="-1"></a><span class="fu">qqPlot</span>(<span class="fu">resid</span>(tglm1))  <span class="do">## residuals should line up pretty closely to the blue line</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-44-1"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-44-1.png" alt="Residual plots." width="672" />
<p class="caption">
Figure 3.6: Residual plots.
</p>
</div>
<pre><code>## Allison, Mrs. Hudson J C (Bessi        Evans, Miss. Edith Corse 
##                               3                              90</code></pre>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="generalized-linear-models.html#cb330-1" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">resid</span>(tglm1) <span class="sc">~</span> t1<span class="sc">$</span>passengerClass)  <span class="do">## variances should be homogeneous for each group</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-44-2"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-44-2.png" alt="Residual plots." width="672" />
<p class="caption">
Figure 3.7: Residual plots.
</p>
</div>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="generalized-linear-models.html#cb331-1" tabindex="-1"></a><span class="do">## simulate residuals</span></span>
<span id="cb331-2"><a href="generalized-linear-models.html#cb331-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">simulateResiduals</span>(tglm1)) <span class="do">## plot simulated residuals</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-45-1"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-45-1.png" alt="Simulated residual plots." width="672" />
<p class="caption">
Figure 4.14: Simulated residual plots.
</p>
</div>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="generalized-linear-models.html#cb332-1" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">simulateResiduals</span>(tglm1)) <span class="do">## histogram should be flat</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-45-2"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-45-2.png" alt="Simulated residual plots." width="672" />
<p class="caption">
Figure 4.15: Simulated residual plots.
</p>
</div>
<p>To make sense of the model output let’s use the emmeans package:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="generalized-linear-models.html#cb333-1" tabindex="-1"></a><span class="fu">emmeans</span>(tglm1, pairwise <span class="sc">~</span> sex<span class="sc">:</span>passengerClass)</span></code></pre></div>
<pre><code>## $emmeans
##  sex    passengerClass emmean    SE  df asymp.LCL asymp.UCL
##  female 1st             3.592 0.516 Inf     2.580    4.6034
##  male   1st            -0.514 0.192 Inf    -0.890   -0.1371
##  female 2nd             1.882 0.325 Inf     1.246    2.5183
##  male   2nd            -2.427 0.303 Inf    -3.022   -1.8324
##  female 3rd            -0.366 0.203 Inf    -0.764    0.0322
##  male   3rd            -1.815 0.170 Inf    -2.149   -1.4814
## 
## Results are given on the logit (not the response) scale. 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast                estimate    SE  df z.ratio p.value
##  female 1st - male 1st      4.106 0.540 Inf   7.599  &lt;.0001
##  female 1st - female 2nd    1.710 0.610 Inf   2.805  0.0567
##  female 1st - male 2nd      6.019 0.602 Inf   9.997  &lt;.0001
##  female 1st - female 3rd    3.958 0.562 Inf   7.040  &lt;.0001
##  female 1st - male 3rd      5.407 0.551 Inf   9.810  &lt;.0001
##  male 1st - female 2nd     -2.396 0.377 Inf  -6.354  &lt;.0001
##  male 1st - male 2nd        1.913 0.364 Inf   5.262  &lt;.0001
##  male 1st - female 3rd     -0.148 0.291 Inf  -0.507  0.9959
##  male 1st - male 3rd        1.302 0.270 Inf   4.826  &lt;.0001
##  female 2nd - male 2nd      4.309 0.444 Inf   9.700  &lt;.0001
##  female 2nd - female 3rd    2.248 0.383 Inf   5.872  &lt;.0001
##  female 2nd - male 3rd      3.698 0.367 Inf  10.088  &lt;.0001
##  male 2nd - female 3rd     -2.061 0.362 Inf  -5.699  &lt;.0001
##  male 2nd - male 3rd       -0.612 0.344 Inf  -1.776  0.4812
##  female 3rd - male 3rd      1.450 0.255 Inf   5.678  &lt;.0001
## 
## Results are given on the log odds ratio (not the response) scale. 
## P value adjustment: tukey method for comparing a family of 6 estimates</code></pre>
<p>The estimates in the above output are transformed via the link funciton (logit in this case). We can obtain back-transformed means. This will provide the estimated probability of survival for each sex:passengerClass combination.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="generalized-linear-models.html#cb335-1" tabindex="-1"></a><span class="fu">emmeans</span>(tglm1, pairwise <span class="sc">~</span> sex<span class="sc">:</span>passengerClass, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)      <span class="do">## type= does contrasts before back-transforming (more appropriate!)</span></span></code></pre></div>
<pre><code>## $emmeans
##  sex    passengerClass   prob     SE  df asymp.LCL asymp.UCL
##  female 1st            0.9732 0.0135 Inf    0.9296     0.990
##  male   1st            0.3743 0.0450 Inf    0.2911     0.466
##  female 2nd            0.8679 0.0372 Inf    0.7766     0.925
##  male   2nd            0.0811 0.0226 Inf    0.0465     0.138
##  female 3rd            0.4096 0.0491 Inf    0.3178     0.508
##  male   3rd            0.1400 0.0205 Inf    0.1044     0.185
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the logit scale 
## 
## $contrasts
##  contrast                odds.ratio       SE  df null z.ratio p.value
##  female 1st / male 1st      60.6736  32.8000 Inf    1   7.599  &lt;.0001
##  female 1st / female 2nd     5.5270   3.3700 Inf    1   2.805  0.0567
##  female 1st / male 2nd     411.1691 248.0000 Inf    1   9.997  &lt;.0001
##  female 1st / female 3rd    52.3345  29.4000 Inf    1   7.040  &lt;.0001
##  female 1st / male 3rd     223.0143 123.0000 Inf    1   9.810  &lt;.0001
##  male 1st / female 2nd       0.0911   0.0344 Inf    1  -6.354  &lt;.0001
##  male 1st / male 2nd         6.7767   2.4600 Inf    1   5.262  &lt;.0001
##  male 1st / female 3rd       0.8626   0.2510 Inf    1  -0.507  0.9959
##  male 1st / male 3rd         3.6756   0.9910 Inf    1   4.826  &lt;.0001
##  female 2nd / male 2nd      74.3935  33.1000 Inf    1   9.700  &lt;.0001
##  female 2nd / female 3rd     9.4690   3.6200 Inf    1   5.872  &lt;.0001
##  female 2nd / male 3rd      40.3503  14.8000 Inf    1  10.088  &lt;.0001
##  male 2nd / female 3rd       0.1273   0.0460 Inf    1  -5.699  &lt;.0001
##  male 2nd / male 3rd         0.5424   0.1870 Inf    1  -1.776  0.4812
##  female 3rd / male 3rd       4.2613   1.0900 Inf    1   5.678  &lt;.0001
## 
## P value adjustment: tukey method for comparing a family of 6 estimates 
## Tests are performed on the log odds ratio scale</code></pre>
<p>In order to plot we need to create new variable that is 0 or 1, instead of ‘yes’ or ‘no’.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="generalized-linear-models.html#cb337-1" tabindex="-1"></a>t1<span class="sc">$</span>surv <span class="ot">&lt;-</span> <span class="fu">if_else</span>(t1<span class="sc">$</span>survived<span class="sc">==</span><span class="st">&#39;yes&#39;</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span></code></pre></div>
<p>Now we can make a plot with regression lines:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="generalized-linear-models.html#cb338-1" tabindex="-1"></a><span class="fu">ggplot</span>(t1, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>surv, <span class="at">color=</span>sex)) <span class="sc">+</span> </span>
<span id="cb338-2"><a href="generalized-linear-models.html#cb338-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">height=</span>.<span class="dv">1</span>, <span class="at">width=</span><span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb338-3"><a href="generalized-linear-models.html#cb338-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;glm&quot;</span>,</span>
<span id="cb338-4"><a href="generalized-linear-models.html#cb338-4" tabindex="-1"></a>              <span class="at">method.args=</span><span class="fu">list</span>(<span class="at">family=</span><span class="st">&quot;binomial&quot;</span>), </span>
<span id="cb338-5"><a href="generalized-linear-models.html#cb338-5" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se=</span>F, <span class="at">lwd=</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb338-6"><a href="generalized-linear-models.html#cb338-6" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>passengerClass) <span class="sc">+</span></span>
<span id="cb338-7"><a href="generalized-linear-models.html#cb338-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-49"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-49-1.png" alt="Plot of survival probabilities by sex and class." width="672" />
<p class="caption">
Figure 4.16: Plot of survival probabilities by sex and class.
</p>
</div>
<p>We can improve the aesthetics of the plot:</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="generalized-linear-models.html#cb339-1" tabindex="-1"></a>tm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(tglm1, <span class="sc">~</span> sex<span class="sc">:</span>passengerClass, <span class="at">type=</span><span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb339-2"><a href="generalized-linear-models.html#cb339-2" tabindex="-1"></a></span>
<span id="cb339-3"><a href="generalized-linear-models.html#cb339-3" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb339-4"><a href="generalized-linear-models.html#cb339-4" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">data=</span>t1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex<span class="sc">==</span><span class="st">&#39;female&#39;</span>),</span>
<span id="cb339-5"><a href="generalized-linear-models.html#cb339-5" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x=</span>passengerClass, <span class="at">y=</span>surv<span class="fl">+.01</span>, <span class="at">color=</span>sex),</span>
<span id="cb339-6"><a href="generalized-linear-models.html#cb339-6" tabindex="-1"></a>              <span class="at">height=</span><span class="dv">0</span>, <span class="at">width=</span>.<span class="dv">25</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha=</span>.<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb339-7"><a href="generalized-linear-models.html#cb339-7" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">data=</span>t1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex<span class="sc">==</span><span class="st">&#39;male&#39;</span>), </span>
<span id="cb339-8"><a href="generalized-linear-models.html#cb339-8" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x=</span>passengerClass, <span class="at">y=</span>surv<span class="fl">-.01</span>, <span class="at">color=</span>sex), </span>
<span id="cb339-9"><a href="generalized-linear-models.html#cb339-9" tabindex="-1"></a>              <span class="at">height=</span><span class="dv">0</span>, <span class="at">width=</span>.<span class="dv">25</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha=</span>.<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb339-10"><a href="generalized-linear-models.html#cb339-10" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">data=</span>tm,</span>
<span id="cb339-11"><a href="generalized-linear-models.html#cb339-11" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">x=</span>passengerClass,</span>
<span id="cb339-12"><a href="generalized-linear-models.html#cb339-12" tabindex="-1"></a>                    <span class="at">y=</span>prob, <span class="at">ymin=</span>(prob<span class="sc">-</span>SE), </span>
<span id="cb339-13"><a href="generalized-linear-models.html#cb339-13" tabindex="-1"></a>                    <span class="at">ymax=</span>(prob<span class="sc">+</span>SE), <span class="at">color=</span>sex), </span>
<span id="cb339-14"><a href="generalized-linear-models.html#cb339-14" tabindex="-1"></a>                <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">lwd=</span><span class="fl">1.25</span>,</span>
<span id="cb339-15"><a href="generalized-linear-models.html#cb339-15" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb339-16"><a href="generalized-linear-models.html#cb339-16" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>tm , </span>
<span id="cb339-17"><a href="generalized-linear-models.html#cb339-17" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x=</span>passengerClass, <span class="at">y=</span>prob, <span class="at">color=</span>sex), </span>
<span id="cb339-18"><a href="generalized-linear-models.html#cb339-18" tabindex="-1"></a>             <span class="at">size=</span><span class="dv">5</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb339-19"><a href="generalized-linear-models.html#cb339-19" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&#39;survival&#39;</span>, <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb339-20"><a href="generalized-linear-models.html#cb339-20" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> T) <span class="sc">+</span></span>
<span id="cb339-21"><a href="generalized-linear-models.html#cb339-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_blank</span>(),                           </span>
<span id="cb339-22"><a href="generalized-linear-models.html#cb339-22" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb339-23"><a href="generalized-linear-models.html#cb339-23" tabindex="-1"></a>                                    <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">size=</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb339-24"><a href="generalized-linear-models.html#cb339-24" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.length=</span><span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">&quot;cm&quot;</span>),  </span>
<span id="cb339-25"><a href="generalized-linear-models.html#cb339-25" tabindex="-1"></a>        <span class="at">axis.text.x =</span>  <span class="fu">element_text</span>(<span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="st">&quot;pt&quot;</span>),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>),</span>
<span id="cb339-26"><a href="generalized-linear-models.html#cb339-26" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="st">&quot;pt&quot;</span>),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>)) <span class="sc">+</span>  <span class="do">## change axis tick marks to make them a little longer</span></span>
<span id="cb339-27"><a href="generalized-linear-models.html#cb339-27" tabindex="-1"></a>  <span class="co">#theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +</span></span>
<span id="cb339-28"><a href="generalized-linear-models.html#cb339-28" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>)) </span></code></pre></div>
<pre><code>## Warning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.
## ℹ Please use the `linewidth` argument instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="generalized-linear-models.html#cb341-1" tabindex="-1"></a>plot1</span></code></pre></div>
<p><img src="03-Module_4_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="generalized-linear-models.html#cb342-1" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb342-2"><a href="generalized-linear-models.html#cb342-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">data=</span>t1 ,</span>
<span id="cb342-3"><a href="generalized-linear-models.html#cb342-3" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x=</span>passengerClass, <span class="at">y=</span>surv, </span>
<span id="cb342-4"><a href="generalized-linear-models.html#cb342-4" tabindex="-1"></a>                  <span class="at">color=</span>passengerClass), </span>
<span id="cb342-5"><a href="generalized-linear-models.html#cb342-5" tabindex="-1"></a>              <span class="at">height=</span>.<span class="dv">01</span>, <span class="at">width=</span>.<span class="dv">35</span>, </span>
<span id="cb342-6"><a href="generalized-linear-models.html#cb342-6" tabindex="-1"></a>              <span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha=</span>.<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb342-7"><a href="generalized-linear-models.html#cb342-7" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">data=</span>tm ,</span>
<span id="cb342-8"><a href="generalized-linear-models.html#cb342-8" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">x=</span>passengerClass,</span>
<span id="cb342-9"><a href="generalized-linear-models.html#cb342-9" tabindex="-1"></a>                    <span class="at">y=</span>prob, <span class="at">ymin=</span>(prob<span class="sc">-</span>SE),</span>
<span id="cb342-10"><a href="generalized-linear-models.html#cb342-10" tabindex="-1"></a>                    <span class="at">ymax=</span>(prob<span class="sc">+</span>SE), </span>
<span id="cb342-11"><a href="generalized-linear-models.html#cb342-11" tabindex="-1"></a>                    <span class="at">color=</span>passengerClass), </span>
<span id="cb342-12"><a href="generalized-linear-models.html#cb342-12" tabindex="-1"></a>                <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">lwd=</span><span class="fl">1.25</span>) <span class="sc">+</span> <span class="do">## make bars thinner</span></span>
<span id="cb342-13"><a href="generalized-linear-models.html#cb342-13" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>tm , </span>
<span id="cb342-14"><a href="generalized-linear-models.html#cb342-14" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x=</span>passengerClass, </span>
<span id="cb342-15"><a href="generalized-linear-models.html#cb342-15" tabindex="-1"></a>                 <span class="at">y=</span>prob, <span class="at">color=</span>passengerClass), <span class="at">size=</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb342-16"><a href="generalized-linear-models.html#cb342-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sex) <span class="sc">+</span></span>
<span id="cb342-17"><a href="generalized-linear-models.html#cb342-17" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&#39;survival&#39;</span>, <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb342-18"><a href="generalized-linear-models.html#cb342-18" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> T, <span class="at">option =</span> <span class="st">&#39;C&#39;</span>, <span class="at">direction=</span><span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb342-19"><a href="generalized-linear-models.html#cb342-19" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_blank</span>(),                           </span>
<span id="cb342-20"><a href="generalized-linear-models.html#cb342-20" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">size=</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb342-21"><a href="generalized-linear-models.html#cb342-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.length=</span><span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">&quot;cm&quot;</span>),  </span>
<span id="cb342-22"><a href="generalized-linear-models.html#cb342-22" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="st">&quot;pt&quot;</span>),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>),</span>
<span id="cb342-23"><a href="generalized-linear-models.html#cb342-23" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="st">&quot;pt&quot;</span>),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb342-24"><a href="generalized-linear-models.html#cb342-24" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>)) </span>
<span id="cb342-25"><a href="generalized-linear-models.html#cb342-25" tabindex="-1"></a>plot2</span></code></pre></div>
<p><img src="03-Module_4_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
</div>
<div id="gamma-glm" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Gamma GLM<a href="generalized-linear-models.html#gamma-glm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section we will learn about implementing the Gamma distribution in R. This distribution is helpful in for modeling a variety of data but is most frequently applied to data that is right skewed but not necessarily count data. The next several examples will illustrate how to generate Gamma distributed data based on several parameters as well as how to implement Gamma GLMs.</p>
<div id="example-1" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Example 1<a href="generalized-linear-models.html#example-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here we generate a distribution using the <code>rgamma()</code> function. Remember to set.seed so we get reproducible results.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="generalized-linear-models.html#cb343-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">15</span>)</span>
<span id="cb343-2"><a href="generalized-linear-models.html#cb343-2" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1000</span>, <span class="at">shape =</span> <span class="dv">2</span>, <span class="at">scale =</span> .<span class="dv">5</span>)</span>
<span id="cb343-3"><a href="generalized-linear-models.html#cb343-3" tabindex="-1"></a><span class="fu">hist</span>(var1, <span class="at">main=</span><span class="st">&#39;mean=1, scale=0.5&#39;</span>)</span></code></pre></div>
<p><img src="03-Module_4_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<p>Note that the mean of this distribution should be 1 because the mean is equal to product of the shape parameter and scale parameter. So, 2 multiplied by 0.5 should be 1.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="generalized-linear-models.html#cb344-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">15</span>)</span>
<span id="cb344-2"><a href="generalized-linear-models.html#cb344-2" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(var1 <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family=</span><span class="fu">Gamma</span>(<span class="at">link=</span><span class="st">&quot;inverse&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in glmmTMB(var1 ~ 1, family = Gamma(link = &quot;inverse&quot;)): use of the
## &#39;data&#39; argument is recommended</code></pre>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="generalized-linear-models.html#cb346-1" tabindex="-1"></a>g1</span></code></pre></div>
<pre><code>## Formula:          var1 ~ 1
##       AIC       BIC    logLik  df.resid 
## 1822.0994 1831.9149 -909.0497       998 
## 
## Number of obs: 1000
## 
## Dispersion estimate for Gamma family (sigma^2): 0.483 
## 
## Fixed Effects:
## 
## Conditional model:
## (Intercept)  
##      0.9657</code></pre>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="generalized-linear-models.html#cb348-1" tabindex="-1"></a><span class="do">## mean should be ~1 with inverse link function</span></span>
<span id="cb348-2"><a href="generalized-linear-models.html#cb348-2" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fl">0.9657</span></span></code></pre></div>
<pre><code>## [1] 1.035518</code></pre>
<p>In the above example we run a Gamma GLM as an intercept only model. By running an intercept only model we assume no other predictors can predict the response variable. Therefore the output from this model would simply be the mean of the response, which should be ~1 (which it is after applying the right link function to the intercept).</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="generalized-linear-models.html#cb350-1" tabindex="-1"></a>g1a <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(var1 <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family=</span><span class="fu">Gamma</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in glmmTMB(var1 ~ 1, family = Gamma(link = &quot;log&quot;)): use of the &#39;data&#39;
## argument is recommended</code></pre>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="generalized-linear-models.html#cb352-1" tabindex="-1"></a>g1a</span></code></pre></div>
<pre><code>## Formula:          var1 ~ 1
##       AIC       BIC    logLik  df.resid 
## 1822.0994 1831.9149 -909.0497       998 
## 
## Number of obs: 1000
## 
## Dispersion estimate for Gamma family (sigma^2): 0.483 
## 
## Fixed Effects:
## 
## Conditional model:
## (Intercept)  
##     0.03491</code></pre>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="generalized-linear-models.html#cb354-1" tabindex="-1"></a><span class="do">## mean should be ~1 with log link function</span></span>
<span id="cb354-2"><a href="generalized-linear-models.html#cb354-2" tabindex="-1"></a><span class="fu">exp</span>(<span class="fl">0.03491</span>)</span></code></pre></div>
<pre><code>## [1] 1.035527</code></pre>
<p>The same is shown above but in this case we use a log link and so to back transform the intercept we exponentiate. Using either the inverse or log-link should give us the same answer.</p>
</div>
<div id="example-2" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Example 2<a href="generalized-linear-models.html#example-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the example below we generate another Gamma distributed variable but we change the shape and scale parameter. But because the mean is based on the product of the two, the mean remains as 1.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="generalized-linear-models.html#cb356-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">15</span>)</span>
<span id="cb356-2"><a href="generalized-linear-models.html#cb356-2" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1000</span>, <span class="at">shape =</span> <span class="dv">4</span>, <span class="at">scale =</span> .<span class="dv">25</span>)</span>
<span id="cb356-3"><a href="generalized-linear-models.html#cb356-3" tabindex="-1"></a><span class="fu">hist</span>(var1, <span class="at">main=</span><span class="st">&#39;mean=1, scale=0.25&#39;</span>)</span></code></pre></div>
<p><img src="03-Module_4_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="generalized-linear-models.html#cb357-1" tabindex="-1"></a><span class="co"># mean = a (shape) * b (rate)</span></span>
<span id="cb357-2"><a href="generalized-linear-models.html#cb357-2" tabindex="-1"></a><span class="co"># mean = 4 * .25 = 1.0</span></span>
<span id="cb357-3"><a href="generalized-linear-models.html#cb357-3" tabindex="-1"></a></span>
<span id="cb357-4"><a href="generalized-linear-models.html#cb357-4" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(var1 <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family=</span><span class="fu">Gamma</span>(<span class="at">link=</span><span class="st">&quot;inverse&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in glmmTMB(var1 ~ 1, family = Gamma(link = &quot;inverse&quot;)): use of the
## &#39;data&#39; argument is recommended</code></pre>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="generalized-linear-models.html#cb359-1" tabindex="-1"></a>g1</span></code></pre></div>
<pre><code>## Formula:          var1 ~ 1
##       AIC       BIC    logLik  df.resid 
## 1281.0616 1290.8771 -638.5308       998 
## 
## Number of obs: 1000
## 
## Dispersion estimate for Gamma family (sigma^2): 0.233 
## 
## Fixed Effects:
## 
## Conditional model:
## (Intercept)  
##      0.9711</code></pre>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="generalized-linear-models.html#cb361-1" tabindex="-1"></a><span class="do">## mean should be 1 with inverse link function</span></span>
<span id="cb361-2"><a href="generalized-linear-models.html#cb361-2" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fl">0.9711</span></span></code></pre></div>
<pre><code>## [1] 1.02976</code></pre>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="generalized-linear-models.html#cb363-1" tabindex="-1"></a>g1a <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(var1 <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family=</span><span class="fu">Gamma</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in glmmTMB(var1 ~ 1, family = Gamma(link = &quot;log&quot;)): use of the &#39;data&#39;
## argument is recommended</code></pre>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="generalized-linear-models.html#cb365-1" tabindex="-1"></a>g1a</span></code></pre></div>
<pre><code>## Formula:          var1 ~ 1
##       AIC       BIC    logLik  df.resid 
## 1281.0616 1290.8771 -638.5308       998 
## 
## Number of obs: 1000
## 
## Dispersion estimate for Gamma family (sigma^2): 0.233 
## 
## Fixed Effects:
## 
## Conditional model:
## (Intercept)  
##     0.02937</code></pre>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="generalized-linear-models.html#cb367-1" tabindex="-1"></a><span class="do">## mean should be 1 with log link function</span></span>
<span id="cb367-2"><a href="generalized-linear-models.html#cb367-2" tabindex="-1"></a><span class="fu">exp</span>(<span class="fl">0.02937</span>)</span></code></pre></div>
<pre><code>## [1] 1.029806</code></pre>
<p>We once again repeat the same exercise as example 1 and see that when the appropriate back transformation based on link functions are applied to the intercept, it results in the original mean.</p>
</div>
<div id="example-3" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Example 3<a href="generalized-linear-models.html#example-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this example we change the mean of the distribution to 0.5 by changing the shape and scale parameters to 1 and 0.5 respectively. We then repeat the previous examples and run the inverse and log link Gamma GLMs and observe how the intercepts are backtransformed to approximate the previously set mean value.</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="generalized-linear-models.html#cb369-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">15</span>)</span>
<span id="cb369-2"><a href="generalized-linear-models.html#cb369-2" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1000</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">scale =</span> .<span class="dv">5</span>)</span>
<span id="cb369-3"><a href="generalized-linear-models.html#cb369-3" tabindex="-1"></a><span class="fu">hist</span>(var1, <span class="at">main=</span><span class="st">&#39;mean=0.5, scale=0.5&#39;</span>)</span></code></pre></div>
<p><img src="03-Module_4_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="generalized-linear-models.html#cb370-1" tabindex="-1"></a><span class="co"># mean = a (shape) * b (rate)</span></span>
<span id="cb370-2"><a href="generalized-linear-models.html#cb370-2" tabindex="-1"></a><span class="co"># mean = 1 * .5 = 0.5</span></span>
<span id="cb370-3"><a href="generalized-linear-models.html#cb370-3" tabindex="-1"></a></span>
<span id="cb370-4"><a href="generalized-linear-models.html#cb370-4" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(var1 <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family=</span><span class="fu">Gamma</span>(<span class="at">link=</span><span class="st">&quot;inverse&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in glmmTMB(var1 ~ 1, family = Gamma(link = &quot;inverse&quot;)): use of the
## &#39;data&#39; argument is recommended</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="generalized-linear-models.html#cb372-1" tabindex="-1"></a>g1</span></code></pre></div>
<pre><code>## Formula:          var1 ~ 1
##       AIC       BIC    logLik  df.resid 
##  654.8480  664.6635 -325.4240       998 
## 
## Number of obs: 1000
## 
## Dispersion estimate for Gamma family (sigma^2): 0.968 
## 
## Fixed Effects:
## 
## Conditional model:
## (Intercept)  
##       1.963</code></pre>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="generalized-linear-models.html#cb374-1" tabindex="-1"></a><span class="do">## mean should be 1 with inverse link function</span></span>
<span id="cb374-2"><a href="generalized-linear-models.html#cb374-2" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span>g1<span class="sc">$</span>sdr<span class="sc">$</span>par.fixed[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>##      beta 
## 0.5095401</code></pre>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="generalized-linear-models.html#cb376-1" tabindex="-1"></a>g1a <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(var1 <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family=</span><span class="fu">Gamma</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in glmmTMB(var1 ~ 1, family = Gamma(link = &quot;log&quot;)): use of the &#39;data&#39;
## argument is recommended</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="generalized-linear-models.html#cb378-1" tabindex="-1"></a>g1a<span class="sc">$</span>sdr<span class="sc">$</span>par.fixed[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>##       beta 
## -0.6742484</code></pre>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="generalized-linear-models.html#cb380-1" tabindex="-1"></a><span class="do">## mean should be 1 with log link function</span></span>
<span id="cb380-2"><a href="generalized-linear-models.html#cb380-2" tabindex="-1"></a><span class="fu">exp</span>(g1a<span class="sc">$</span>sdr<span class="sc">$</span>par.fixed[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##      beta 
## 0.5095393</code></pre>
</div>
<div id="example-4" class="section level3 hasAnchor" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> Example 4<a href="generalized-linear-models.html#example-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This example follows the previous examples but with the mean changed to 0.25.</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="generalized-linear-models.html#cb382-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">15</span>)</span>
<span id="cb382-2"><a href="generalized-linear-models.html#cb382-2" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1000</span>, <span class="at">shape =</span> .<span class="dv">25</span>, <span class="at">scale =</span> <span class="dv">1</span>)</span>
<span id="cb382-3"><a href="generalized-linear-models.html#cb382-3" tabindex="-1"></a><span class="fu">hist</span>(var1, <span class="at">main=</span><span class="st">&#39;mean=0.25, scale=1&#39;</span>)</span></code></pre></div>
<p><img src="03-Module_4_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="generalized-linear-models.html#cb383-1" tabindex="-1"></a><span class="co"># mean = a (shape) * b (rate)</span></span>
<span id="cb383-2"><a href="generalized-linear-models.html#cb383-2" tabindex="-1"></a><span class="co"># mean = .5 * 1 = 0.5</span></span>
<span id="cb383-3"><a href="generalized-linear-models.html#cb383-3" tabindex="-1"></a></span>
<span id="cb383-4"><a href="generalized-linear-models.html#cb383-4" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(var1 <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family=</span><span class="fu">Gamma</span>(<span class="at">link=</span><span class="st">&quot;inverse&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in glmmTMB(var1 ~ 1, family = Gamma(link = &quot;inverse&quot;)): use of the
## &#39;data&#39; argument is recommended</code></pre>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="generalized-linear-models.html#cb385-1" tabindex="-1"></a>g1</span></code></pre></div>
<pre><code>## Formula:          var1 ~ 1
##       AIC       BIC    logLik  df.resid 
## -3174.013 -3164.197  1589.006       998 
## 
## Number of obs: 1000
## 
## Dispersion estimate for Gamma family (sigma^2): 3.94 
## 
## Fixed Effects:
## 
## Conditional model:
## (Intercept)  
##       3.964</code></pre>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="generalized-linear-models.html#cb387-1" tabindex="-1"></a><span class="do">## mean should be 1 with inverse link function</span></span>
<span id="cb387-2"><a href="generalized-linear-models.html#cb387-2" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span>g1<span class="sc">$</span>sdr<span class="sc">$</span>par.fixed[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>##      beta 
## 0.2522893</code></pre>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="generalized-linear-models.html#cb389-1" tabindex="-1"></a>g1a <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(var1 <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family=</span><span class="fu">Gamma</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in glmmTMB(var1 ~ 1, family = Gamma(link = &quot;log&quot;)): use of the &#39;data&#39;
## argument is recommended</code></pre>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="generalized-linear-models.html#cb391-1" tabindex="-1"></a>g1a</span></code></pre></div>
<pre><code>## Formula:          var1 ~ 1
##       AIC       BIC    logLik  df.resid 
## -3174.013 -3164.197  1589.006       998 
## 
## Number of obs: 1000
## 
## Dispersion estimate for Gamma family (sigma^2): 3.94 
## 
## Fixed Effects:
## 
## Conditional model:
## (Intercept)  
##      -1.377</code></pre>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="generalized-linear-models.html#cb393-1" tabindex="-1"></a><span class="do">## mean should be 1 with log link function</span></span>
<span id="cb393-2"><a href="generalized-linear-models.html#cb393-2" tabindex="-1"></a><span class="fu">exp</span>(g1a<span class="sc">$</span>sdr<span class="sc">$</span>par.fixed[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##      beta 
## 0.2522895</code></pre>
</div>
</div>
<div id="briefly-running-gamma-glms" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Briefly running Gamma GLMs<a href="generalized-linear-models.html#briefly-running-gamma-glms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section we simulate data for two groups:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="generalized-linear-models.html#cb395-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">25</span>)</span>
<span id="cb395-2"><a href="generalized-linear-models.html#cb395-2" tabindex="-1"></a>v1 <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">100</span>, <span class="at">shape =</span> <span class="dv">3</span>, <span class="at">scale =</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb395-3"><a href="generalized-linear-models.html#cb395-3" tabindex="-1"></a><span class="fu">colnames</span>(v1) <span class="ot">&lt;-</span> <span class="st">&quot;var&quot;</span></span>
<span id="cb395-4"><a href="generalized-linear-models.html#cb395-4" tabindex="-1"></a>v1<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;one&quot;</span></span>
<span id="cb395-5"><a href="generalized-linear-models.html#cb395-5" tabindex="-1"></a><span class="fu">head</span>(v1)</span></code></pre></div>
<pre><code>##         var group
## 1 1.0881400   one
## 2 2.4520815   one
## 3 3.5583571   one
## 4 0.9405657   one
## 5 0.9225875   one
## 6 1.4339098   one</code></pre>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="generalized-linear-models.html#cb397-1" tabindex="-1"></a>v2 <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">100</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">scale =</span> .<span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb397-2"><a href="generalized-linear-models.html#cb397-2" tabindex="-1"></a><span class="fu">colnames</span>(v2) <span class="ot">&lt;-</span> <span class="st">&quot;var&quot;</span></span>
<span id="cb397-3"><a href="generalized-linear-models.html#cb397-3" tabindex="-1"></a>v2<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="st">&quot;two&quot;</span></span>
<span id="cb397-4"><a href="generalized-linear-models.html#cb397-4" tabindex="-1"></a><span class="fu">head</span>(v2)</span></code></pre></div>
<pre><code>##          var group
## 1 0.15108136   two
## 2 0.01761541   two
## 3 0.47914554   two
## 4 0.05403794   two
## 5 0.13555345   two
## 6 0.19157853   two</code></pre>
<p>Then bind the two groups into one dataset:</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="generalized-linear-models.html#cb399-1" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(v1,v2) <span class="co">#mean group 1 = 1.5, group 2 = 0.5</span></span>
<span id="cb399-2"><a href="generalized-linear-models.html#cb399-2" tabindex="-1"></a>dat1 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">obs=</span><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">2</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(obs) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> group,<span class="at">values_from =</span> var) <span class="sc">%&gt;%</span> </span>
<span id="cb399-3"><a href="generalized-linear-models.html#cb399-3" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(one,two)</span></code></pre></div>
<pre><code>## # A tibble: 100 × 2
##      one     two
##    &lt;dbl&gt;   &lt;dbl&gt;
##  1 1.09  0.151  
##  2 2.45  0.0176 
##  3 3.56  0.479  
##  4 0.941 0.0540 
##  5 0.923 0.136  
##  6 1.43  0.192  
##  7 0.559 0.185  
##  8 1.20  0.0195 
##  9 1.15  0.0725 
## 10 0.854 0.00261
## # ℹ 90 more rows</code></pre>
<p>We then check the data distributions:</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="generalized-linear-models.html#cb401-1" tabindex="-1"></a><span class="fu">hist</span>(dat1<span class="sc">$</span>var)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-62"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-62-1.png" alt="Histogram." width="672" />
<p class="caption">
Figure 2.41: Histogram.
</p>
</div>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="generalized-linear-models.html#cb402-1" tabindex="-1"></a><span class="fu">ggplot</span>(dat1, <span class="fu">aes</span>(<span class="at">x=</span>var)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">8</span>, <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>) <span class="sc">+</span> </span>
<span id="cb402-2"><a href="generalized-linear-models.html#cb402-2" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>group, <span class="at">scales=</span><span class="st">&quot;free&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-63"></span>
<img src="03-Module_4_files/figure-html/unnamed-chunk-63-1.png" alt="Histogram for each group." width="672" />
<p class="caption">
Figure 4.17: Histogram for each group.
</p>
</div>
<p>Then we construct several different models (a Gaussian, a Gamma, and a log-normal) and use AIC to compare models. Obviously we know the data come from a Gamma distribution because we simulated them. However, we will fit these different models to examine model fit using residuals and AIC.</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="generalized-linear-models.html#cb403-1" tabindex="-1"></a><span class="do">#### construct model w/ normal distribution</span></span>
<span id="cb403-2"><a href="generalized-linear-models.html#cb403-2" tabindex="-1"></a>mod0 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(var <span class="sc">~</span> group, <span class="at">data=</span>dat1)</span>
<span id="cb403-3"><a href="generalized-linear-models.html#cb403-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">simulateResiduals</span>(mod0))</span></code></pre></div>
<p><img src="03-Module_4_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="generalized-linear-models.html#cb404-1" tabindex="-1"></a><span class="fu">summary</span>(mod0)</span></code></pre></div>
<pre><code>##  Family: gaussian  ( identity )
## Formula:          var ~ group
## Data: dat1
## 
##      AIC      BIC   logLik deviance df.resid 
##    408.0    417.9   -201.0    402.0      197 
## 
## 
## Dispersion estimate for gaussian family (sigma^2): 0.437 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.49247    0.06610   22.58   &lt;2e-16 ***
## grouptwo    -1.28086    0.09349  -13.70   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="generalized-linear-models.html#cb406-1" tabindex="-1"></a><span class="fu">emmeans</span>(mod0, <span class="sc">~</span>group, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<pre><code>##  group emmean     SE  df lower.CL upper.CL
##  one    1.492 0.0661 197   1.3621    1.623
##  two    0.212 0.0661 197   0.0813    0.342
## 
## Confidence level used: 0.95</code></pre>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="generalized-linear-models.html#cb408-1" tabindex="-1"></a><span class="do">#### construct model w/ log-normal distribution</span></span>
<span id="cb408-2"><a href="generalized-linear-models.html#cb408-2" tabindex="-1"></a>mod0a <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(<span class="fu">log</span>(var) <span class="sc">~</span> group, <span class="at">data=</span>dat1)</span>
<span id="cb408-3"><a href="generalized-linear-models.html#cb408-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">simulateResiduals</span>(mod0a))</span></code></pre></div>
<p><img src="03-Module_4_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="generalized-linear-models.html#cb409-1" tabindex="-1"></a><span class="fu">summary</span>(mod0a)</span></code></pre></div>
<pre><code>##  Family: gaussian  ( identity )
## Formula:          log(var) ~ group
## Data: dat1
## 
##      AIC      BIC   logLik deviance df.resid 
##    585.6    595.5   -289.8    579.6      197 
## 
## 
## Dispersion estimate for gaussian family (sigma^2): 1.06 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   0.2288     0.1030   2.221   0.0264 *  
## grouptwo     -2.3798     0.1457 -16.330   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="generalized-linear-models.html#cb411-1" tabindex="-1"></a><span class="fu">emmeans</span>(mod0a, <span class="sc">~</span>group, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<pre><code>##  group response    SE  df lower.CL upper.CL
##  one      1.257 0.130 197    1.026    1.540
##  two      0.116 0.012 197    0.095    0.143
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale</code></pre>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="generalized-linear-models.html#cb413-1" tabindex="-1"></a><span class="do">#### construct model w/ Gamma distribution and inverse link</span></span>
<span id="cb413-2"><a href="generalized-linear-models.html#cb413-2" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(var <span class="sc">~</span> group, <span class="at">data=</span>dat1, <span class="at">family=</span><span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;inverse&quot;</span>))</span>
<span id="cb413-3"><a href="generalized-linear-models.html#cb413-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">simulateResiduals</span>(mod1))</span></code></pre></div>
<p><img src="03-Module_4_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="generalized-linear-models.html#cb414-1" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>##  Family: Gamma  ( inverse )
## Formula:          var ~ group
## Data: dat1
## 
##      AIC      BIC   logLik deviance df.resid 
##    160.7    170.6    -77.3    154.7      197 
## 
## 
## Dispersion estimate for Gamma family (sigma^2): 0.693 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  0.67003    0.05577   12.01   &lt;2e-16 ***
## grouptwo     4.05552    0.39726   10.21   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="generalized-linear-models.html#cb416-1" tabindex="-1"></a><span class="fu">emmeans</span>(mod1, <span class="sc">~</span>group, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<pre><code>##  group response     SE  df asymp.LCL asymp.UCL
##  one      1.492 0.1240 Inf     1.283     1.783
##  two      0.212 0.0176 Inf     0.182     0.253
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the inverse scale</code></pre>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="generalized-linear-models.html#cb418-1" tabindex="-1"></a><span class="do">#### construct model w/ Gamma distribution and log link</span></span>
<span id="cb418-2"><a href="generalized-linear-models.html#cb418-2" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(var <span class="sc">~</span> group, <span class="at">data=</span>dat1, <span class="at">family=</span><span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>))</span>
<span id="cb418-3"><a href="generalized-linear-models.html#cb418-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">simulateResiduals</span>(mod2))</span></code></pre></div>
<p><img src="03-Module_4_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="generalized-linear-models.html#cb419-1" tabindex="-1"></a><span class="fu">summary</span>(mod2)</span></code></pre></div>
<pre><code>##  Family: Gamma  ( log )
## Formula:          var ~ group
## Data: dat1
## 
##      AIC      BIC   logLik deviance df.resid 
##    160.7    170.6    -77.3    154.7      197 
## 
## 
## Dispersion estimate for Gamma family (sigma^2): 0.693 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  0.40043    0.08323   4.811  1.5e-06 ***
## grouptwo    -1.95342    0.11771 -16.595  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="generalized-linear-models.html#cb421-1" tabindex="-1"></a><span class="fu">emmeans</span>(mod2, <span class="sc">~</span>group, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<pre><code>##  group response     SE  df asymp.LCL asymp.UCL
##  one      1.492 0.1240 Inf      1.27     1.757
##  two      0.212 0.0176 Inf      0.18     0.249
## 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale</code></pre>
<p>AIC:</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="generalized-linear-models.html#cb423-1" tabindex="-1"></a><span class="fu">AIC</span>(mod0,mod0a,mod1,mod2)</span></code></pre></div>
<pre><code>##       df      AIC
## mod0   3 408.0006
## mod0a  3 585.5705
## mod1   3 160.6724
## mod2   3 160.6724</code></pre>
<p>Which model is the best ranked model?</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-management-and-exploration.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mixed-effect-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/03-Module_4.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"smooth_scroll": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
